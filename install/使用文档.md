## 简介
HotSeconds是一款Java远程热部署的插件，分为HotSecondsClient和HotSecondsServer，理论上来说可以热更新任何文件(java,xml,html,css,js等)，也支持常用框架(Spring,MyBatis)的热更新，可以节省大量的打包->部署->启动的时间。<br>
目前支持Java8，不久会发布Java11和Java17版本。

### 最新功能
###### 建议定时更新插件的客户端和服务端，最新版一定是bug最少，功能最全，并且还向下兼容（除非API和机制不支持），有很多bug可能在某个版本已经修复了。
- HotSecondsClient1.8.0 + HotSecondsServer-future 可以支持批量热部署修改的文件了，包括java和resource，其中resource是配置mapping path的资源文件
- HotSecondsClient1.8.3增加了Git/SVN差异文件热部署

[点击这里-所有功能介绍](https://github.com/thanple/HotSecondsIDEA/wiki/HotSeconds%E6%89%80%E6%9C%89%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D)


### 问题反馈和交流
大家有问题直接建Issues即可，这样也方便别人看到，也不会被刷屏，也可以看[Wiki](https://github.com/thanple/HotSecondsIDEA/wiki)常见问题。

<br>

## HotSecondsServer下载
[HotSecondsServer.zip安装包下载链接](https://github.com/thanple/HotSecondsIDEA/blob/master/install/download_server.md)


## Server端安装(Java8)

### 1.安装服务器包 ###
【Linux】下载HotSecondsServer.zip到本地解压，然后去[libjvm.so](https://github.com/thanple/HotSecondsIDEA/blob/master/install/libjvm_so.md)找对应的jdk版本下载完后无需改名直接放到解压后目录的./lib下，然后上传到服务器(记目录为path1)，执行sh install.sh<br>
【Windows & MacOS 本地热部署】先去[dcevm](https://github.com/thanple/HotSecondsIDEA/blob/master/install/dcevm_installer.md) 找到你的JDK版本的jar包，下载下来后运行jar（可能需要管理员权限或者root权限）安装，选择Install DCEVM as altjvm，再将HotSecondsServer.zip解压后，放到你的工程根目录，记目录为$path1<br><br>
 验证是否成功: 输入java -XXaltjvm=dcevm -version，能出来结果就表示前2步成功，后面会一马平川

### 2.配置hot-seconds-remote.xml ###
将hot-seconds-remote.xml复制到代码的resource目录(随便找个目录都行,记目录为path2)，根据需要修改secret和classloader等配置。<br>
secret参数只要唯一就行，需要保证客户端和服务器的secret是一致的，classloader参数的配置如下:
- **普通项目** : AppClassLoader
- **Tomcat项目** : Tomcat7及以下填WebappClassLoader，Tomcat8及以上填ParallelWebappClassLoader 
- **SpringBoot项目** : LaunchedURLClassLoader(如果是本地main函数启动classloader为AppClassLoader)
- 其他容器项目 : 可以在需要热更新的类上远程断点getClass().getClassLoader()看看是哪个classloader，填上就行，也可留言我后续补充下文档

### 3.添加jvm参数 ###
添加jvm参数开启热部署代理 -XXaltjvm=dcevm -javaagent:$path1/HotSecondsServer.jar=hotconf=$path2/hot-seconds-remote.xml<br>
其中$path1是第1步上传的目录，$path2是第2步上传的目录
<br><br>
***友情提醒：只在测试/沙箱加这个参数就行，线上就不要加这个参数了，不加这个参数就不会开启热部署代理***

<br>

## Client端安装

支持操作系统：所有系统<br>
版本要求：IDEA2020.3以及之后的版本
### 安装步骤 ###

1. 首先禁用IDEA自带的HotSwap功能，Setting->Build,Execution,Deployment->Debugger->HotSwap->Reload classes after compilation 选 Never，这样就不会和IDEA自带的热更新冲突，然后在插件市场下载安装HotSecondsClient
2. 选择菜单Run->HotSeconds Settings->Settings可以添加连接的服务器和配置，其中secret和远程服务器需要保持一致，填写本地和远程映射路径即可将本地目录的文件上传到远程，包括子文件夹的文件.<br>
如果是.class文件可以不填，其他的文件都需要填<br><br>
![](https://github.com/thanple/HotSecondsIDEA/blob/master/img/hotseconds-setting.png)
3. 点击Debug旁边的头像开启HotSeconds插件，也可以点击Run->HotSeconds Start/Stop开启HotSeconds插件，底部HotSecondsClient控制台也有操作按钮，IDEA最新的UI没有Debug旁边的头像了，Run菜单和HotSecondsClient控制台都是有的，然后就可以开启热部署之旅了，右键菜单和HotSecondsClient控制台都有热部署的功能，当热部署java文件时，会先编译再热部署到远程，如果编译失败，先整体build一下工程再热部署(这是基本操作)。

### 插件快捷键 ###
在Keymap->Plugins->HotSecondsClient里面可以自定义快捷键，建议设置HotSeconds Start/Stop和Hot swap this file的快捷键<br>
![](https://github.com/thanple/HotSecondsIDEA/blob/master/img/keymap.png)


### 所有功能预览 ###
#### [点击这里-所有功能介绍](https://github.com/thanple/HotSecondsIDEA/wiki/HotSeconds%E6%89%80%E6%9C%89%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D) ####
| 功能 | 解释 | 位置 | 关键字(可设置快捷键) |
| ------ | ------ | ------ | ------ |
|热部署开关 | 修改完配置后需要重新打开开关 | Run菜单/HotSecondsClient控制台| HotSeconds Start/Stop |
|热部署当前文件 | 热部署到远程的路径需要配置路径映射, 如果是java文件可以不用配置 | 打开文件右键/工程菜单右键选中文件 | Hot swap this file |
|远程编译并热部署文件 | 上传源码到远程编译并热部署，解决了本地和远程版本不一致问题|java文件右键 | Remote compilation and Hot swap |
|热部署整个jar | 上传到远程然后批量热部署jar内所有.class |打开jar包任意.class然后右键 | Hot deploy the JAR to remote |
|远程执行方法 | 需要静态无参方法才能执行,可以用这个方法调用其他有参数和非静态方法 |静态无参方法上右键 |Run method on remote server |
|自动热部署 | 填完路径映射后，需要重新打开开关，插件会监听本地目录文件变化并自动上传到远程(.class文件除外,如果是.class用Hot swap this file功能) |Run->HotSeconds Settings->Settings | 
|批量热部署修改文件 | 修改的文件可以批量热部署，包括java和resource | HotSecondsClient控制台->批量热部署修改文件 | Batch Hot Reloading Modified Files |

## 关于扩展
每个公司都有自己的框架，市面上的新框架也有很多，本插件能兼容万物，可以扩展热更新文件的前置逻辑和后置逻辑，从这一点上来看，本插件能热部署整个世界一切的一切。<br>
复制HotSecondsServer.zip中的IHotExtHandler.java到你的项目，实现这个接口，然后在hot-seconds-remote.xml里面配置上你的类名就可以了，这样像一些需要刷新缓存和上下文的逻辑就可以触发。<br>

**也可以引用扩展包HotSecondsExtension，这样不用重复造轮子，扩展包是一些常用的框架刷新逻辑，以便兼容更多的第三方框架和使用场景，让我们把这个项目做大做强吧，人人皆可参与**

[HotSecondsExtension项目](https://github.com/Liubsyy/HotSecondsExtension)


<br>

## 未来
+ 不断更新和完善新框架和市面流行框架的热部署，把扩展包做成一个新的项目
+ 支持更高版本的JDK的热部署，比如Java11、Java17
+ 插件增加一些实用的功能，类似于远程执行函数这种功能（已经实现），欢迎大家给出建议
+ 扩展插件到其他的编程语言和IDE



