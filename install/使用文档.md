## 最新功能预览

- HotSecondsClient1.8.0 + HotSecondsServer-future 可以支持批量热部署修改的文件了，包括java和resource，其中resource是配置mapping path的资源文件
  ![](https://github.com/thanple/HotSecondsIDEA/blob/master/img/batch_hot_reloading.png)

- HotSecondsClient-1.7.0版本在控制台就集齐了所有的菜单按钮
  ![](https://github.com/thanple/HotSecondsIDEA/blob/master/img/consoleview.png)




## 简介
HotSeconds这个插件主要用于将代码热部署到远程服务器，秒级生效，全程一键化操作，节省大量的修改->打包->部署流程的时间。
本插件分为HotSecondsClient和HotSecondsServer。<br>
目前仅支持jdk8的使用，后续根据需求量再考虑支持java11，java17等更高版本。<br>

#### 热部署文件范围
支持所有右键选中的文件热部署到服务器，包括java，jar里面的.class文件，xml, html等文件，但是除java外其他文件都需要配置路径映射。<br>

#### 插件内核已支持
| 开源组件                                         | 范围                              |
|----------------------------------------------|---------------------------------|
| Java                                       | 修改代码，新增字段，新增方法，新增类，修改动态代理类 |
| Spring                                       | 包括Spring，SpringMVC，SpringBoot生态 |
| MyBatis                                      | 支持mapper修改xml文件(扩展包HotSecondsExtension已支持新增mapper和xml)  |
| MyBatis Plus                                 | 同MyBatis                        |
| Hibernate                                    | 支持Hibernate2和Hibernate3         |
| Freemarker<br/>Thymeleaf<br/>Velocity-Spring | 刷新缓存                            |

更多的组件/框架热更新请关注扩展开源项目[HotSecondsExtension](https://github.com/Liubsyy/HotSecondsExtension)


#### 问题反馈和交流
大家有问题直接建Issues即可，这样也方便别人看到，也不会被刷屏。


<br><br>

## HotSecondsServer下载
[HotSecondsServer.zip安装包下载链接](https://github.com/thanple/HotSecondsIDEA/blob/master/install/download_server.md)

<br><br>

## Server端安装(Linux)

MacOS和Windows请参考下面的**关于本地热部署**

<br>

1.下载HotSecondsServer.zip到本地解压，先在看看服务器jdk版本(远程和本地不一定相同)，本地执行sh download.sh versionnum<br>
例: 服务器输入java -version 显示 "1.8.0_181" 那么versionnum=181，然后执行sh download.sh 181，此时会下载需要的文件。<br>
如果下载github资源慢，记得开终端的代理 <br><br>
也可以手动去[libjvm.so](https://github.com/thanple/HotSecondsIDEA/blob/master/install/libjvm_so.md)找对应的版本下载，下载完后无需改名直接放到解压后目录的./lib下。<br><br>

2.上传第1步的操作完的包到服务器端，在服务器上执行sh install.sh <br>

**验证是否成功: 输入java -XXaltjvm=dcevm -version，能出来结果就表示前2步成功，后面会一马平川**
<br><br>

3.将hot-seconds-remote.xml复制到代码的resource目录，根据需要修改secret和classloader等配置<br><br>

&lt;secret&gt;
```
这个只要唯一就行，需要保证客户端和服务器的secret是一致的
```

&lt;classloader&gt;

| 项目类型 | classloader |
| ------ | ------ |
|普通项目 | AppClassLoader |
|Tomcat项目 | Tomcat7及以下填WebappClassLoader，Tomcat8及以上填ParallelWebappClassLoader |
|SpringBoot项目 | LaunchedURLClassLoader(如果是本地main函数启动classloader为AppClassLoader) |
|其他容器项目 | 可以在需要热更新的类上远程断点getClass().getClassLoader()看看是哪个classloader，填上就行，也可留言我后续补充下文档 |

<br><br>
4.添加jvm参数开启热部署代理 -XXaltjvm=dcevm -javaagent:$path1/HotSecondsServer.jar=hotconf=$path2/hot-seconds-remote.xml<br>
其中$path1是第2步上传的目录，$path2是第3步上传的目录
<br><br>
***友情提醒：只在测试/沙箱加这个参数就行，线上就不要加这个参数了，不加这个参数就不会开启热部署代理***

**这些操作执行完后，部署并启动服务器**
<br><br>


## Client端安装

**支持操作系统：所有系统**<br><br>
**版本要求：IDEA2020.3以及之后的版本**<br><br>
1.插件市场下载安装HotSecondsClient<br><br>
![](https://github.com/thanple/HotSecondsIDEA/blob/master/img/pluginmarketplace.png)
<br><br>
2.选择菜单Run->HotSeconds Settings->Settings可以添加连接的服务器和配置<br><br>
其中secret和远程服务器需要保持一致，填写本地和远程映射路径即可将本地目录的文件上传到远程，包括子文件夹的文件.<br>
如果是.class文件可以不填，其他的文件都需要填<br><br>
![](https://github.com/thanple/HotSecondsIDEA/blob/master/img/hotseconds-setting.png)

<br>


<br><br>
3.点击Debug旁边的头像开启HotSeconds插件，最新版的UI可以点击Run->HotSeconds Start/Stop开启HotSeconds插件，右键可以将选中文件热部署到远程服务器.<br>

**当热部署java文件时，会先编译再热部署到远程，如果编译失败，先整体build一下工程再热部署(这是基本操作)**

**最新版的UI可以点击Run->HotSeconds Start/Stop开启HotSeconds，也可以在HotSecondsClient控制台打开连接**<br>

![](https://github.com/thanple/HotSecondsIDEA/blob/master/img/newui.png)




<br><br><br>


## 快速入门
- 安装完后，点击Debug旁边的按钮启动连接远程服务器，新版本的UI可以选择Run菜单->HotSeconds Start/Stop(最新版UI建议设置快捷键).
  <br>HotSecondsClient-1.7.0之后的版本在控制台就集齐了所有的功能
  ![](https://github.com/thanple/HotSecondsIDEA/blob/master/img/consoleview.png)

- 打开java文件，右键选择Hot swap this file to remote可热部署当前文件，左侧工程中的文件也可以右键选择热部署.
![](https://github.com/thanple/HotSecondsIDEA/blob/master/img/use.png)

- 针对java文件右键，还可以选择Remote compilation and Hot swap，即远程编译并热部署.

- 控制台：在普通控制台旁边有一个插件专用HotSecondsClient控制台，里面打印了一些热部署信息，以及远程执行函数返回的字符串.

- 批量热部署修改文件：HotSecondsClient控制台，增加了一个批量热部署按钮，打开弹框可将修改的文件批量热部署.
  ![](https://github.com/thanple/HotSecondsIDEA/blob/master/img/batch_hot_reloading.png)
  
- 其他：Run->HotSeconds Settings中可以选择语言，添加IP等快捷操作的功能

<br>


### 插件所有功能
| 功能 | 解释 | 位置 | 关键字(可设置快捷键) |
| ------ | ------ | ------ | ------ |
|热部署开关 | 修改完配置后需要重新打开开关 | Run菜单/Debug旁边的头像按钮| HotSeconds Start/Stop |
|热部署当前文件 | 热部署到远程的路径需要配置路径映射, 如果是java文件可以不用配置 | 打开文件右键/工程菜单右键选中文件 | Hot swap this file |
|远程编译并热部署文件 | 上传源码到远程编译并热部署，远程需要安装jdk(而不是jre),解决了本地和远程版本不一致问题|java文件右键 | Remote compilation and Hot swap |
|热部署整个jar | 上传到远程然后批量热部署jar内所有.class |打开jar包任意.class然后右键 | Hot deploy the JAR to remote |
|远程执行方法 | 需要静态无参方法才能执行,可以用这个方法调用其他有参数和非静态方法 |静态无参方法上右键 |Run method on remote server |
|自动热部署 | 填完路径映射后，需要重新打开开关，插件会监听本地目录文件变化并自动上传到远程(.class文件除外,如果是.class用Hot swap this file功能) |Run->HotSeconds Settings->Settings | 
|批量热部署修改文件 | 修改的文件可以批量热部署，包括java和resource | HotSecondsClient控制台->批量热部署修改文件 | Batch Hot Reloading Modified Files |


<br><br>

### 插件快捷键
在Keymap->Plugins->HotSecondsClient里面可以自定义快捷键<br>
![](https://github.com/thanple/HotSecondsIDEA/blob/master/img/keymap.png)
<br>比如可以设置HotSeconds Start/Stop快捷键和Hot swap this file快捷键.<br><br>




## 关于本地热部署
大炮打蚊子，不是很推荐，如果你需要这么做，可以按以下步骤安装
1. jdk版本最好 <= java8u181，去[dcevm](https://github.com/thanple/HotSecondsIDEA/blob/master/install/dcevm_installer.md) 找到你的JDK版本的jar包(支持macOS, Linux and Windows)，下载下来后运行jar（可能需要管理员权限或者root权限）安装，选择Install DCEVM as altjvm
2. 将本安装包[HotSecondsServer.zip](https://github.com/thanple/HotSecondsIDEA/blob/master/install/download_server.md)解压后，放到你的工程根目录，记目录为$path1
3. 参考Server端安装(Linux)的第3步和第4步
4. 因为是本地部署，配置路径里面的Local Path和Remote Path可以填一样的
   
安装完后选择设置->Build,Execution,Deployment->Debugger->HotSwap->Reload classes after compilation 选 Never，这样就不会和IDEA自带的热更新冲突.
![](https://github.com/thanple/HotSecondsIDEA/blob/master/img/cancel_ori_hotswap.png)


<br>

## 关于扩展
每个公司都有自己的框架，市面上的新框架也有很多，本插件能兼容万物，可以扩展热更新文件的前置逻辑和后置逻辑，从这一点上来看，本插件能热部署整个世界一切的一切。<br>
复制HotSecondsServer.zip中的IHotExtHandler.java到你的项目，实现这个接口，然后在hot-seconds-remote.xml里面配置上你的类名就可以了，这样像一些需要刷新缓存和上下文的逻辑就可以触发。<br>


**也可以引用扩展包HotSecondsExtension，这样不用重复造轮子，扩展包是一些常用的框架刷新逻辑，以便兼容更多的第三方框架和使用场景，让我们把这个项目做大做强吧，人人皆可参与**

[HotSecondsExtension项目](https://github.com/Liubsyy/HotSecondsExtension)



<br>

## 未来
+ 不断更新和完善新框架和市面流行框架的热部署，把扩展包做成一个新的项目
+ 支持更高版本的JDK的热部署，比如Java11、Java17
+ 插件增加一些实用的功能，类似于远程执行函数这种功能（已经实现），欢迎大家给出建议
+ 扩展插件到其他的编程语言和IDE



