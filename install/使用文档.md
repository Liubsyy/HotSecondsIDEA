## 简介
HotSeconds是一款Java远程热部署的插件，分为HotSecondsClient和HotSecondsServer，理论上来说可以热更新任何文件(java,xml,html,css,js等)，也支持常用框架(Spring,MyBatis)的热更新，可以节省大量的打包->部署->启动的时间。<br>
目前支持Java8，Java11和Java17。

### 最新功能
- HotSecondsClient-1.9.0 支持连接多个不同的服务器(secret+ip+port多远程连接源)
- HotSecondsServer11 支持Java11和Java17热部署


[点击这里-所有功能介绍](https://github.com/Liubsyy/HotSecondsIDEA/wiki/HotSeconds%E6%89%80%E6%9C%89%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D)


### 问题反馈和交流
常识性问题可以先谷歌/百度，或者看[常见问题和解决方案](https://github.com/Liubsyy/HotSecondsIDEA/wiki/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88)，如果还有问题直接建Issues即可，这样也方便别人看到，也不会被刷屏。

<br>


## Server端安装

[HotSecondsServer.zip安装包下载链接](https://github.com/Liubsyy/HotSecondsIDEA/blob/master/install/download_server.md)

### 1.安装服务器包 ###
`温馨提示: JDK11不能用Java8版本的HotSecondsServer.zip，原因是Java9之后的模块化不向下兼容，另外如果某版本jdk不可用换个版本即可，不要吊死在一颗树上。如果使用OracleJDK和普通OpenJDK也可以启动，但是热更新不支持新增字段和方法，其他功能都正常。`

**【Java8】**
 - Linux: 下载HotSecondsServer.zip到本地解压，然后去[libjvm.so](https://github.com/Liubsyy/HotSecondsIDEA/blob/master/install/libjvm_so.md)找对应的jdk版本下载完后无需改名直接放到解压后目录的./lib下，然后上传到服务器(记目录为$path1)，执行sh install.sh<br>
 - Windows & MacOS 本地热部署: 先去[dcevm](https://github.com/Liubsyy/HotSecondsIDEA/blob/master/install/dcevm_installer.md) 找到你的JDK版本的jar包（**版本一致很重要**），下载下来后运行jar（可能需要管理员权限或者root权限）安装，选择Install DCEVM as altjvm，再将HotSecondsServer.zip解压后，放到你的工程根目录（记目录为$path1）<br>

`验证是否成功: 输入java -XXaltjvm=dcevm -version，能出来结果就表示第1步成功，后面会一马平川`

**【Java11】**
<br>首先下载[Trava-JDK11](https://github.com/TravaOpenJDK/trava-jdk-11-dcevm/releases)当作你的JDK启动，此JDK是基于OpenJDK11改造的
<br>然后下载HotSecondsServer11.zip解压缩放到服务器上(记目录为$path1)

**【Java17】**
<br>首先下载[JBR17](https://github.com/JetBrains/JetBrainsRuntime/releases)作为你的JDK启动，此JDK是基于OpenJDK17改造的
<br>然后下载HotSecondsServer11.zip解压缩放到服务器上(记目录为$path1)


### 2.配置hot-seconds-remote.xml ###
将hot-seconds-remote.xml复制到代码的resource目录(随便找个目录都行,记目录为$path2)，根据需要修改配置。<br>
- secret: 参数只要唯一就行，需要保证客户端和服务器的secret是一致的
- remote_port: 这个端口必须是一个独立的端口，仅用于热部署服务的通信，不要和其他任何端口(比如HTTP，RPC)共用
- init_delay: 延迟多长时间启动热部署监听端口，单位ms
- classloader：
   - 普通项目 : AppClassLoader
   - Tomcat项目 : Tomcat7及以下填WebappClassLoader，Tomcat8及以上填ParallelWebappClassLoader
   - SpringBoot项目 : LaunchedURLClassLoader(如果是本地main函数启动填AppClassLoader)
   - 其他容器项目 : 可以在需要热更新的类上远程断点getClass().getClassLoader()看看是哪个classloader，填上就行，也可留言我后续补充下文档

既然知道答案了为什么还要手填classloader而不做成自动识别classloader呢？其实硬编码识别这些Tomcat容器和SpringBoot容器易如反掌，最主要还是为了兼容一切容器，比如公司自己开发了一套框架，或者自定义了classloader容器来启动。

### 3.添加jvm参数 ###
添加jvm参数开启热部署代理 
* Java8添加jvm参数 : -XXaltjvm=dcevm -javaagent:$path1/HotSecondsServer.jar=hotconf=$path2/hot-seconds-remote.xml
* Java11添加jvm参数 : --add-opens java.desktop/com.sun.beans.introspect=ALL-UNNAMED --add-opens java.base/java.lang=ALL-UNNAMED --add-opens java.base/java.lang.reflect=ALL-UNNAMED -javaagent:$path1/HotSecondsServer.jar=hotconf=$path2/hot-seconds-remote.xml
* Java17添加jvm参数 : --add-opens java.desktop/com.sun.beans.introspect=ALL-UNNAMED --add-opens java.base/java.lang=ALL-UNNAMED --add-opens java.base/java.lang.reflect=ALL-UNNAMED -XX:+AllowEnhancedClassRedefinition -javaagent:$path1/HotSecondsServer.jar=hotconf=$path2/hot-seconds-remote.xml

其中$path1是第1步上传的目录，$path2是第2步上传的目录

`友情提醒：只在测试/沙箱加这个参数就行，线上就不要加这个参数了，不加这个参数就不会开启热部署代理`

<br>

## Client端安装

支持操作系统：所有系统<br>
版本要求：IDEA2020.3以及之后的版本
### 安装步骤 ###

1. 首先禁用IDEA自带的HotSwap功能，Setting->Build,Execution,Deployment->Debugger->HotSwap->Reload classes after compilation 选 Never，这样就不会和IDEA自带的热更新冲突，然后在插件市场下载安装HotSecondsClient
2. 选择菜单Run->HotSeconds Settings->Settings可以添加连接的服务器和配置，如果是本地热部署ip填127.0.0.1，secret和远程服务器需要保持一致，填写本地和远程映射路径即可将本地目录的文件上传到远程，包括子文件夹的文件.<br>
如果是.class文件可以不填，其他的文件都需要填<br><br>
![](https://github.com/Liubsyy/HotSecondsIDEA/blob/master/img/hotseconds-setting.png)

   所有参数配置如下：
   * Remote Secret/IP/Port: 和远程保持一致即可
   * File Type: 文件后缀名，如有多个以英文,隔开
   * Local Path: 本地路径，$rootPath$是个变量，表示IDEA工程的根目录
   * Remote Path: 远程服务端绝对路径，如果是本地写本地绝对路径


4. 打开底部的HotSecondsClient控制台，点击头像连接远程，另外在Run菜单和Debug旁边也有快捷按钮，但是控制台是最全的，然后就可以开启热部署之旅了，右键菜单和HotSecondsClient控制台都有热部署的功能，当热部署java文件时，会先编译再热部署到远程，如果编译失败，先整体build一下工程再热部署(这是基本操作)<br><br>
   ![](https://github.com/Liubsyy/HotSecondsIDEA/blob/master/img/wiki/consoleview.png)

<br>
   这里演示增加一个Spring字段和SpringMVC方法的热更新<br><br>

   ![](https://github.com/Liubsyy/HotSecondsIDEA/blob/master/img/gif/springmvc1.gif)

<br>

### 插件快捷键 ###
在Keymap->Plugins->HotSecondsClient里面可以自定义快捷键，建议设置HotSeconds Start/Stop和Hot swap this file的快捷键<br>
![](https://github.com/Liubsyy/HotSecondsIDEA/blob/master/img/keymap.png)


### 所有功能预览 ###
#### [点击这里-所有功能介绍](https://github.com/Liubsyy/HotSecondsIDEA/wiki/HotSeconds%E6%89%80%E6%9C%89%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D) ####
| 功能 | 解释 | 位置 | 关键字(可设置快捷键) |
| ------ | ------ | ------ | ------ |
|热部署开关 | 修改完配置后需要重新打开开关 | Run菜单/HotSecondsClient控制台| HotSeconds Start/Stop |
|热部署当前文件 | 热部署到远程的路径需要配置路径映射, 如果是java文件可以不用配置 | 打开文件右键/工程菜单右键选中文件 | Hot swap this file |
|远程编译并热部署文件 | 上传源码到远程编译并热部署，解决了本地和远程版本不一致问题|java文件右键 | Remote compilation and Hot swap |
|热部署整个jar | 上传到远程然后批量热部署jar内所有.class |打开jar包任意.class然后右键 | Hot deploy the JAR to remote |
|远程执行方法 | 需要静态无参方法才能执行,可以用这个方法调用其他有参数和非静态方法 |静态无参方法上右键 |Run method on remote server |
|自动热部署 | 填完路径映射后，需要重新打开开关，插件会监听本地目录文件变化并自动上传到远程(.class文件除外,如果是.class用Hot swap this file功能) |Run->HotSeconds Settings->Settings | 
|批量热部署修改文件 | 修改的文件可以批量热部署，包括java和resource | HotSecondsClient控制台->批量热部署修改文件 | Batch Hot Reloading Modified Files |

## 关于扩展
每个公司都有自己的框架，市面上的新框架也有很多，本插件能兼容万物，可以扩展热更新文件的前置逻辑和后置逻辑，从这一点上来看，本插件能热部署整个世界一切的一切。<br>
复制HotSecondsServer.zip中的IHotExtHandler.java到你的项目，实现这个接口，然后在hot-seconds-remote.xml里面配置上你的类名就可以了，这样像一些需要刷新缓存和上下文的逻辑就可以触发。<br>

**也可以引用扩展包HotSecondsExtension，这样不用重复造轮子，扩展包是一些常用的框架刷新逻辑，以便兼容更多的第三方框架和使用场景，让我们把这个项目做大做强吧，人人皆可参与**

[HotSecondsExtension项目](https://github.com/Liubsyy/HotSecondsExtension)


<br>

## 未来
- 不断更新和完善新框架和市面流行框架的热部署，把扩展包做成一个新的项目
- 支持更高版本的JDK的热部署
- 插件增加一些实用的功能，类似于远程执行函数这种功能（已经实现），欢迎大家给出建议
- 扩展插件到其他的编程语言和IDE



